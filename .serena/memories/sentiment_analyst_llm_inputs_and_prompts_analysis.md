# 市场情绪分析LLM模型输入数据和Prompt详细分析

## 1. 整体架构：混合分析模型

市场情绪分析采用"传统规则 + AI增强"的混合模型，LLM分析是整个流程的核心增强环节。

## 2. LLM输入数据结构

### A. 传统量化分析结果摘要
通过`_format_traditional_analysis_summary`方法格式化，包含：
- **整体情绪**: 情绪得分、倾向（看涨/看跌/中性）、置信度
- **情绪趋势**: 趋势方向、变化幅度、时间序列分析
- **风险信号**: 情绪极值评估、市场过热/恐慌判断
- **关键信号**: 识别的重要情绪转折点或事件
- **置信度**: 传统分析的可靠性评分（0-1）

### B. 原始市场数据摘要
通过`_format_raw_data_summary`方法格式化，包含：
- **Twitter情绪**: 推文数量、正面/负面/中性推文数、情绪得分、参与度
- **Reddit讨论**: 帖子数量、评论情绪、热度指标
- **Telegram群组**: 群组活跃度、消息情绪、讨论热度
- **新闻情绪**: 新闻数量、情感倾向、重要新闻摘要
- **恐惧贪婪指数**: 当前指数值、历史趋势、极端值标记
- **社交媒体热度**: 讨论量变化、热度趋势、异常波动
- **影响者观点**: KOL观点摘要、影响力评分

## 3. LLM Prompt构建流程

### 第一步：定义分析维度
情绪分析专用的7个深度分析维度：
1. **情绪趋势预测** - 基于历史模式预测未来3-7天情绪变化趋势
2. **市场情绪周期** - 判断当前处于情绪周期的哪个阶段
3. **异常情绪信号** - 识别可能影响价格的异常情绪变化和极端情绪
4. **交易心理洞察** - 分析群体心理对交易行为的影响和市场预期
5. **反向指标价值** - 评估情绪指标作为反向指标的可靠性
6. **情绪传导机制** - 分析情绪在不同平台和群体间的传播路径
7. **置信度评估** - 评估情绪分析结果的可靠性和预测准确度

### 第二步：定义输出字段
期望LLM返回的JSON结构包含8个字段：
- `sentiment_prediction`: 情绪预测结果
- `market_emotion_cycle`: 市场情绪周期分析
- `anomaly_signals`: 异常信号识别
- `trading_psychology`: 交易心理洞察
- `contrarian_indicators`: 反向指标分析
- `sentiment_forecast`: 情绪预测
- `confidence_level`: 置信度评估
- `key_insights`: 关键洞察总结

### 第三步：构建完整Prompt
通过`_build_standard_analysis_prompt`方法生成最终的提示词，包含：

```
你是一位专业的加密货币市场情绪分析师，擅长深度数据分析和市场洞察。

请基于以下数据进行专业分析：

## 传统量化分析结果：
{
  "整体情绪": {...},
  "情绪趋势": {...},
  "风险信号": {...},
  "关键信号": {...},
  "置信度": 0.XX
}

## 原始市场数据：
{
  "Twitter情绪": {...},
  "Reddit讨论": {...},
  "Telegram群组": {...},
  "新闻情绪": {...},
  "恐惧贪婪指数": {...},
  "社交媒体热度": {...},
  "影响者观点": {...}
}

请从以下7个维度进行深度分析：

1. **情绪趋势预测 - 基于历史模式预测未来3-7天情绪变化趋势**
2. **市场情绪周期 - 判断当前处于情绪周期的哪个阶段**
3. **异常情绪信号 - 识别可能影响价格的异常情绪变化和极端情绪**
4. **交易心理洞察 - 分析群体心理对交易行为的影响和市场预期**
5. **反向指标价值 - 评估情绪指标作为反向指标的可靠性**
6. **情绪传导机制 - 分析情绪在不同平台和群体间的传播路径**
7. **置信度评估 - 评估情绪分析结果的可靠性和预测准确度**

请以JSON格式返回分析结果，包含以下8个字段：

{
    "sentiment_prediction": "相应分析结果",
    "market_emotion_cycle": "相应分析结果",
    "anomaly_signals": "相应分析结果",
    "trading_psychology": "相应分析结果",
    "contrarian_indicators": "相应分析结果",
    "sentiment_forecast": "相应分析结果",
    "confidence_level": "相应分析结果",
    "key_insights": "相应分析结果"
}

请确保分析专业、客观，基于数据驱动的判断，避免过度投机的预测。
```

## 4. 数据源详情

### Twitter数据源格式
```python
{
    "tweet_count": 1000-5000,  # 推文总数
    "positive_tweets": 300-1500,  # 正面推文数
    "negative_tweets": 200-1000,  # 负面推文数
    "neutral_tweets": 500-2500,  # 中性推文数
    "sentiment_score": 0.3-0.8,  # 情绪得分
    "engagement_rate": 0.05-0.25,  # 参与度
    "trending_hashtags": ["#BTC", "#Crypto", ...],  # 热门标签
    "top_influencers": ["@crypto_analyst", ...],  # 影响者
    "sentiment_trend": "rising/falling/stable",  # 情绪趋势
    "hourly_data": [...]  # 小时级数据
}
```

### 其他数据源
- Reddit: 帖子数、评论数、情绪分布、热门话题
- Telegram: 群组活跃度、消息情绪、用户参与度
- News: 新闻数量、情感倾向、关键词提取
- Fear & Greed: 指数值、历史对比、极端值标记
- Social Volume: 讨论量、热度趋势、异常检测

## 5. AI增强分析流程

1. **数据预处理**: 格式化传统分析和原始数据
2. **Prompt构建**: 组合数据源、分析维度、输出格式
3. **LLM调用**: 通过统一的LLMService发送请求
4. **结果解析**: 解析JSON格式的AI分析结果
5. **结果融合**: 将AI分析与传统分析结合，计算综合置信度
6. **容错处理**: AI失败时自动降级到传统分析

## 6. 关键特性

- **元分析能力**: LLM不仅分析原始数据，还分析传统分析的结果
- **多维度洞察**: 从7个专业维度进行深度分析
- **结构化输出**: 标准化的JSON格式便于后续处理
- **容错设计**: 确保系统稳定性
- **可扩展性**: 标准化的prompt构建方法可复用