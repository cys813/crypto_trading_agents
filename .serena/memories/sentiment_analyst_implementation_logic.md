# 情绪分析师 (SentimentAnalyst) 实现方式和逻辑

## 核心逻辑

情绪分析师的工作流程分为三个主要步骤：

1.  **数据收集 (`collect_data`)**:
    *   从多个预设的社交媒体和新闻来源（如Twitter, Reddit, Telegram, 新闻网站）收集情绪数据。
    *   还会收集一些综合性的情绪指标，例如“恐惧与贪婪指数”（Fear & Greed Index）和社交媒体讨论量（Social Volume）。
    *   目前，这部分数据是通过**模拟数据**生成的，并未对接真实的数据API。

2.  **传统分析 (`_traditional_analyze`)**:
    *   对每个数据源进行独立的、基于**规则**的分析。例如，根据正面/负面推文的比例来判断Twitter情绪是看涨还是看跌。
    *   通过对各个数据源的分析结果进行**加权平均**，计算出一个综合的整体情绪得分和倾向（看涨/看跌/中性）。
    *   进一步分析情绪的**趋势**、评估潜在的**情绪风险**（如市场是否过于狂热或恐慌），并识别出一些**关键信号**。
    *   最后，基于分析结果的内在一致性和动能，计算出一个“传统分析置信度”。

3.  **AI增强分析 (`analyze_with_ai_enhancement`)**:
    *   这是整个分析流程的核心，由`StandardAIAnalysisMixin`提供标准化的实现。
    *   **构建提示词 (`_build_sentiment_analysis_prompt`)**: 将传统分析的结果摘要和原始数据摘要组合成一个非常详细、结构化的提示词（Prompt），并明确要求AI从多个深度维度（如情绪周期、交易心理、异常信号等）进行分析。
    *   **调用AI模型 (`call_ai_analysis`)**: 通过统一的`LLMService`将构建好的提示词发送给大语言模型（如阿里通义千问、DeepSeek）。
    *   **解析与融合 (`_combine_analyses`)**:
        *   解析AI返回的JSON格式的深度分析结果。
        *   将AI的分析结果与传统分析结果进行**融合**。
        *   融合的核心是计算一个新的**综合置信度**，该置信度是传统分析置信度和AI分析置信度的加权平均值（AI的权重通常更高，例如60%）。
        *   最终的输出结果会同时包含传统分析、AI分析以及关于融合过程的元数据，确保了结果的可追溯性。

## AI集成机制 (`ai_analysis_mixin.py` 和 `llm_service.py`)

*   **模块化设计**: 通过`StandardAIAnalysisMixin`混入类，将AI增强的逻辑（如调用AI、解析结果、融合结果）与具体的分析师业务逻辑解耦。这使得其他类型的分析师（如技术分析师、链上分析师）可以轻松复用这套AI集成能力。
*   **统一LLM服务**: `LLMService`作为项目的全局单例，统一管理了与不同大语言模型提供商（目前支持阿里DashScope和DeepSeek）的API交互。它负责处理API密钥、模型选择、参数配置和API调用。
*   **容错与降级**: 如果AI分析的任何一个环节（如API调用、结果解析）失败，系统会自动降级，并返回纯粹的传统分析结果，同时会记录下AI分析失败的原因，保证了系统的健壮性。

## 总结

当前的情绪分析师采用的是一种“**传统规则 + AI增强**”的混合模式：

*   **传统分析**提供了一个快速、稳定且可解释的分析基础。
*   **AI分析**则在此基础上进行升华，提供更深层次的洞察、预测和对复杂非结构化数据的理解，弥补了传统规则模型的不足。

这种设计兼顾了分析的**稳定性、可解释性**和**深度**，是一个非常全面和强大的情绪分析系统。
